# sacli

Easy declarative CLI builder for Node.js applications. Built on top of [command-line-args](https://github.com/75lb/command-line-args) and [command-line-usage](https://github.com/75lb/command-line-usage).

## Features

- Supports multiple commands at any depth.
- Automatically generates nicely formatted documentation for commands.
- Has a simple declarative API that uses plain JavaScript objects and functions.

## Get

Add it to your `package.json`:

```bash
npm i sacli
```

## Usage

There are two simple parts: building the CLI and using it.

### Building

A CLI has one or more commands, which is identified by the arguments immediately following the program. For example, given a program `video`:

- `video` opens a file manager for a video collection.
- `video download` downloads a URL as a file to disk.
- `video convert` converts a video to another format.
- `video convert audio` converts a video to an audio file.

We can represent this in sacli using the `CLI` and `Command` types:

```typescript
import * as sacli from 'sacli';

const OpenCommand: sacli.Command = { name: '', ... };
const DownloadCommand: sacli.Command = { name: 'download', ... };
const ConvertCommand: sacli.Command = { name: 'convert', ... };
const ConvertAudioCommand: sacli.Command = { name: 'convert audio', ... };

const cli = sacli.build({
  name: 'video',
  commands: [
    OpenCommand,
    DownloadCommand,
    ConvertCommand,
    ConvertAudioCommand,
  ], 
});
```

Each command takes four properties:

```typescript
const DownloadCommand: sacli.Command = {
  name: 'download',
  description: 'Save a video to disk from a URL',
  options: [URLsOption],
  action: (download: ParsedDownloadArgs) => ...,
};
```

The **description** is used when showing help for the command. When parsing user-provided arguments, sacli will call **action** with an object built by matching user-provided argument values to options specified in the **options** array. An option has the form:

```typescript
const URLsOption: sacli.Option = {
  // A single-character alternative option specifier that allows the user to specify `-u` instead of `--urls`.
  alias: 'u',
  // How the option is referenced in arguments and what property name to map the value to in the resulting parsed object.
  name: 'urls',
  // Value type. Takes a function that receives a string and returns any value.
  type: String,
  // What to show as this option's value in the command help.
  typeLabel: '<URL>',
  // Shown in the command help for this option.
  description: 'URLs to download',
  // Allows multiple values in the form of `--urls a b c` or `--urls a --urls b --urls c`
  multiple: true,
  // Values not mapped to a specific option will be mapped to this one e.g. `video a b c`.
  defaultOption: true,
};
```

All commands have autogenerated help which can be shown by using `-h` e.g. `video download -h`.

### Executing

The CLI can be used to parse user-provided arguments and execute a command's action using **exec**:

```typescript
sacli.exec(['download', '--urls', 'https://abc.xyz/video1.mp4', 'https://tenfour.com/43726.mp4'], cli);
```

sacli will attempt to find the appropriate subcommand by finding one that matches the most initial argument values. For example, `upload` will match the empty prefix command, while `convert video` will match the `convert` command.

If arguments are provided from `process.argv`, remember to remove the first two elements, which are the Node.js executable and script paths respectively.
